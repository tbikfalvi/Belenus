Server, Client;




#
# Uzenetek formaja


# XML style
# Length attribute a fej >-e es a lab <-e kozotti byteok szama
<hello length="202">
    <version>122</version>
</hello>


#
# HTML style
# szoveges mezokben nem lehet \r\n mert az elvalaszto
packet: hello\r\n
length: 0\r\n
version: 202\r\n
username: 0022883\r\n
password: 231213\r\n
\r\n\r\n # dupla sor jelzi a veget. Binaris adat az utolso \r\n es a \r\n\r\n kozott mehet


#
# Binary style
minden packetet egy struct ir le, ami atkuldesre kerul:  struct { int version; } sHello;
- Nincsenek benne valtozo hosszusagu binaris adatok
int magic
int packet
int length
<data>




#
# Uzenetek
C_HELLO 
    version
S_HELLO 
    version
S_LOGON_CHALLANGE
C_LOGON_RESPONSE               # ha id2 null az adatbazisban, akkor elmenti a szerver. Mostantol a kliens ezzel az id2-vel tud csatlakozni
    id1
    id2
C_ADMIN_LOGON_RESPONSE 
    user
    password
S_LOGIN_OK
S_DISCONNECT
    reason
S_VERSION_MISMATCH             # akkor kuldi a szerver ha a kliens verzioja nem megfelelo
C_REGISTER_LICENSE_KEY         # csak admin kapcsolat soran
    code                 
S_REGISTER_LICENSE_KEY_DONE




#
# Normal kapcsolat
C_HELLO (version)
S_HELLO (version)
S_LOGON_CHALLENGE
C_LOGON_CHALLENGE (id1, id2) 
S_LOGIN_OK



#
# hibas version
C_HELLO
S_HELLO
S_VERSION_MISMATCH
S_DISCONNECT (version mismatch)



#
# admin kapcsolat
C_HELLO
S_HELLO
S_LOGON_CHALLANGE
C_ADMIN_LOGON
S_LOGIN_OK              # user es password ellenorzese az adatbazisban sikeres
S_DISCONNECT            # kulonben disconnect
...                     # regisztralj egy uj licensz keyt
C_REGISTER_CLIENT       # code - SHA1-el kodolt licensz kulcs
S_REGISTER_CLIENT_DONE
...




#
# Folyamat
- kapcsolat beerkezik, listener szal indit egy uj szalat es atadja neki a socketId-t
- client szal recv-zik a socketen, ha jon adat hozzacsapja a bufferhez
- meghivja a bufferen az Packet::isValid(buffer)-t, ami visszaad egy uj packet objectet ha valodi packet erkezett, kulonben null
- ha van packet, akkor meghivodik a handle(Packet), ami eloszor ellenorzi h adott packet engedelyezett e (benne van az allowedPackets listaban) aztan meghivodik a megfelelo handle fuggveny
 
        [main]
           | <<creates>>
      [connection]
   | <<creates>>    \ <<calls>>        \ <<contains>> ServerImplementation, ClientImplementation send...() and handle...() funcs
[packet]           [handlePacket]